// useWebSocket.js
import { useEffect } from 'react';
import { useRecoilState } from 'recoil';
import { wsState } from './recoil/Atoms';

const useWebSocket = (userId) => {
    const [ws, setWs] = useRecoilState(wsState);

    useEffect(() => {
        if (userId) {
            const newWs = new WebSocket(`${url}pushservice?userId=${userId}`);
            newWs.onopen = () => {
                console.log('WebSocket 연결 성공');
                setWs(newWs);
            };
            newWs.onclose = () => {
                console.log('WebSocket 연결 종료');
            };
            newWs.onerror = (error) => {
                console.error('WebSocket 에러:', error);
            };

            return () => {
                newWs.close();
            };
        }
    }, [userId, setWs]);
};

export default useWebSocket;
